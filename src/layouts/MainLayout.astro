---
import MainHead from "./MainHead.astro";
import Footer from "../components/Footer.astro";
import Nav from "../components/Nav.astro";
import Icon from "astro-icon";

import "../styles/main.css";
import "@fontsource-variable/albert-sans";
import "@fontsource/tilt-neon";
interface Props {
  title?: string;
}

const { title = "Dave Tierney's website" } = Astro.props;
---

<html lang="en">
  <MainHead title={title} />
  <body class="bg-background text-primary">
    <Nav />
    <div class="flex items-center justify-center p-2">
      <button
        class="grid h-8 w-8 place-items-center rounded"
        data-theme-toggle
        aria-label="toggle theme"
      >
        <Icon name="bx:bxs-sun" class="h-4 w-4 text-primary hover:text-neon" />
      </button>
    </div>
    <main>
      <slot />
    </main>
    <Footer />
    <script>
      const themeToggles = document.querySelectorAll("[data-theme-toggle]");

      const getTheme = () => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme") === "dark"
        ) {
          return "dark";
        }
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme") === "light"
        ) {
          return "light";
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          return "dark";
        } else return "light";
      };

      const setTheme = (theme: string) =>
        document.documentElement.setAttribute("data-theme", theme);

      window.addEventListener("DOMContentLoaded", () => setTheme(getTheme()));
      document.addEventListener("astro:after-swap", () => setTheme(getTheme()));

      themeToggles.forEach((toggle) => {
        toggle.addEventListener("click", () => {
          const nextTheme = getTheme() === "light" ? "dark" : "light";
          localStorage.setItem("theme", nextTheme);
          setTheme(nextTheme);
        });
      });
    </script>
  </body>
</html>
